import: poi.day.yaml
global:
  poi_min_zoom_filter: |
    function() {
      const poi_extra_data = context.sources[$source].config.extra_data.poi;
      const style = global.get_poi_style(feature, 'IPC', poi_extra_data) ||
          global.get_poi_style(feature, 'default', poi_extra_data);
      return style ? $zoom >= style.min_zoom : false;
    }
  poi:
    IPC:
      override_filter: |
        function(feature) {
          return feature.source === 'ipc';
        }
      visible: true
sources:
  omv:
    extra_data:
      poi:
        IPC:
          300-3200-0031:
            buddhist:
              default:
                icon: japan--religious_temple_buddhist_jpn
                min_zoom: 16
                priority: 33
            default:
              default:
                icon: japan--religious_temple_buddhist_jpn
                min_zoom: 17
                priority: 34
          300-3200-0035:
            shinto:
              default:
                icon: japan--religious_shinto_jpn
                min_zoom: 17
                priority: 35
          350-3500-0235:
            default:
              default:
                icon: japan--nature_waterfall
                min_zoom: 15
                priority: 78
          350-3510-0237:
            default:
              default:
                icon: japan--nature_mountainpass
                min_zoom: 17
                priority: 76
          350-3510-0238:
            default:
              default:
                icon: japan--mountain
                min_zoom: 14
                size: 19
                priority: 0
          400-4000-4581:
            default:
              default:
                icon: japan--transport_airport
                min_zoom: 9
                priority: 0
          400-4000-4582:
            default:
              default:
                icon: japan--transport_airport
                min_zoom: 15
                priority: 1
          400-4100-0035:
            default:
              is_speed_rail:
                icon: japan--transport_shinkansen_jpn
                min_zoom: 9
                priority: 2
              is_state_rail:
                icon: japan--transport_train
                min_zoom: 12
                priority: 3
              is_private_rail:
                icon: japan--transport_train
                min_zoom: 12
                priority: 4
          400-4100-0037:
            default:
              default:
                icon: japan--transport_rail_citymetro
                min_zoom: 13
                priority: 5
          400-4100-0038:
            default:
              default:
                icon: japan--transport_rail_light
                min_zoom: 13
                priority: 6
          400-4100-0040:
            default:
              default:
                min_zoom: 16
                priority: 9
          400-4100-0043:
            default:
              is_speed_rail:
                icon: japan--transport_shinkansen_jpn
                min_zoom: 9
                priority: 0
              is_state_rail:
                icon: japan--transport_train
                min_zoom: 12
                priority: 1
              is_private_rail:
                icon: japan--transport_train
                min_zoom: 12
                priority: 2
              is_subway:
                icon: japan--transport_rail_citymetro
                min_zoom: 13
                priority: 3
              is_suburban:
                icon: japan--transport_rail_light
                min_zoom: 13
                priority: 4
              is_tram:
                icon: japan--transport_rail_light
                min_zoom: 13
                priority: 5
              is_monorail:
                icon: japan--transport_monorail
                min_zoom: 13
                priority: 6
              is_aerial:
                icon: japan--transport_aerial
                min_zoom: 14
                priority: 7
              is_funicular:
                icon: japan--transport_inclined
                min_zoom: 14
                priority: 8
          400-4100-0326:
            default:
              default:
                icon: japan--toll_booth_jpn
                min_zoom: 15
                priority: 45
          400-4100-0337:
            default:
              default:
                icon: japan--transport_rail_light
                min_zoom: 13
                priority: 7
          400-4100-0339:
            default:
              default:
                icon: japan--transport_monorail
                min_zoom: 13
                priority: 8
          400-4100-0340:
            default:
              default:
                icon: japan--transport_aerial
                min_zoom: 14
                priority: 9
          400-4100-0342:
            default:
              default:
                icon: japan--transport_inclined
                min_zoom: 14
                priority: 10
          400-4300-0199:
            default:
              default:
                icon: japan--road_facilities_sa_jpn
                min_zoom: 11
                size:
                  - 18
                  - 14
                priority: 2
          400-4300-0200:
            default:
              default:
                icon: japan--road_facilities_pa_jpn
                min_zoom: 11
                size:
                  - 18
                  - 14
                priority: 3
          400-4300-0201:
            default:
              default:
                icon: japan--road_facilities_pa_jpn
                min_zoom: 11
                size:
                  - 18
                  - 14
                priority: 4
          500-5100-0061:
            default:
              default:
                icon: japan--accommodation_main
                min_zoom: 17
                priority: 89
          700-7200-0271:
            default:
              default:
                icon: japan--business_post_jpn
                min_zoom: 17
                priority: 57
          700-7300-0110:
            default:
              default:
                icon: japan--emergency_policebox_jpn
                min_zoom: 17
                priority: 56
          700-7300-0111:
            default:
              default:
                icon: japan--emergency_police_jpn
                min_zoom: 16
                priority: 28
          700-7300-0113:
            default:
              default:
                icon: japan--emergency_firedepartment_jpn
                min_zoom: 16
                priority: 29
          700-7450-0114:
            default:
              default:
                icon: japan--business_post_jpn
                min_zoom: 17
                priority: 58
          800-8000-0000:
            default:
              default:
                icon: japan--address
                min_zoom: 15
                priority: 21
          800-8000-0159:
            default:
              default:
                icon: japan--emergency_hospital_jpn
                min_zoom: 15
                priority: 20
          800-8100-0163:
            default:
              default:
                icon: japan--facilities_cityhall_jpn
                min_zoom: 14
                priority: 1
          800-8100-0171:
            prefectural_office:
              default:
                icon: japan--facilities_office_prefectural_jpn
                min_zoom: 12
                priority: 0
            town_village_office:
              default:
                icon: japan--facilities_office_townvillage_jpn
                min_zoom: 14
                priority: 2
            ward_office:
              default:
                icon: japan--facilities_office_ward_jpn
                min_zoom: 14
                priority: 3
            default:
              default:
                icon: japan--facilities_main
                min_zoom: 17
                priority: 94
          800-8200-0000:
            default:
              default:
                icon: japan--facilities_education_school_jpn
                min_zoom: 16
                priority: 31
          800-8200-0173:
            default:
              default:
                icon: japan--facilities_education_higher_jpn
                min_zoom: 15
                priority: 23
          800-8200-0174:
            default:
              default:
                icon: japan--facilities_education_school_jpn
                min_zoom: 17
                priority: 59
          900-9400-0402:
            interchange_toll:
              default:
                icon: japan--road_facilities_ic_jpn
                min_zoom: 9
                size:
                  - 18
                  - 14
                priority: 0
            interchange:
              default:
                icon: japan--road_facilities_ic_jpn
                min_zoom: 9
                size:
                  - 18
                  - 14
                priority: 1
            junction:
              default:
                icon: japan--road_facilities_jct_jpn
                min_zoom: 9
                size:
                  - 21
                  - 14
                priority: 5
            smart_interchange:
              default:
                icon: japan--road_facilities_smart_ic_jpn
                min_zoom: 9
                size:
                  - 44
                  - 14
                priority: 6
            default:
              has_traffic_lights:
                icon: japan--traffic_light
                min_zoom: 10
                priority: 0
            intersection:
              default:
                min_zoom: 10
                priority: 0
        default:
          100-1000-0003:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          200-2300-0000:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          300-3200-0031:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          300-3200-0035:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          350-3500-0235:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          350-3510-0237:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          350-3510-0238:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          400-4000-4581:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          400-4000-4582:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          400-4100-0035:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          400-4100-0037:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          400-4100-0038:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          400-4100-0040:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          400-4100-0043:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          400-4100-0326:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          400-4100-0337:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          400-4100-0339:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          400-4100-0340:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          400-4100-0342:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          400-4300-0199:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          400-4300-0200:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          400-4300-0201:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          500-5100-0061:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          700-7200-0271:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          700-7300-0110:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          700-7300-0111:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          700-7300-0113:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          700-7450-0114:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          800-8000-0000:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          800-8000-0159:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          800-8100-0163:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          800-8100-0171:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          800-8200-0000:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          800-8200-0173:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          800-8200-0174:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
          900-9400-0402:
            default:
              default:
                override_filter: global.poi.IPC.override_filter
textures:
  jp_pois:
    url: ./icons/japan_poi-2x.png
    density: 2
    sprites:
      japan--accommodation_main:
        - 2
        - 38
        - 64
        - 64
      japan--address:
        - 106
        - 2
        - 64
        - 64
      japan--business_post_jpn:
        - 2
        - 106
        - 64
        - 64
      japan--emergency_firedepartment_jpn:
        - 70
        - 106
        - 64
        - 64
      japan--emergency_hospital_jpn:
        - 174
        - 2
        - 64
        - 64
      japan--emergency_police_jpn:
        - 174
        - 70
        - 64
        - 64
      japan--emergency_policebox_jpn:
        - 2
        - 174
        - 64
        - 64
      japan--facilities_cityhall_jpn:
        - 70
        - 174
        - 64
        - 64
      japan--facilities_education_higher_jpn:
        - 138
        - 174
        - 64
        - 64
      japan--facilities_education_school_jpn:
        - 242
        - 2
        - 64
        - 64
      japan--facilities_main:
        - 242
        - 70
        - 64
        - 64
      japan--facilities_office_prefectural_jpn:
        - 242
        - 138
        - 64
        - 64
      japan--facilities_office_townvillage_jpn:
        - 2
        - 242
        - 64
        - 64
      japan--facilities_office_ward_jpn:
        - 70
        - 242
        - 64
        - 64
      japan--mountain:
        - 378
        - 156
        - 44
        - 44
      japan--nature_mountainpass:
        - 138
        - 242
        - 64
        - 64
      japan--nature_waterfall:
        - 206
        - 242
        - 64
        - 64
      japan--religious_shinto_jpn:
        - 310
        - 2
        - 64
        - 64
      japan--religious_temple_buddhist_jpn:
        - 310
        - 70
        - 64
        - 64
      japan--road_facilities_ic_jpn:
        - 378
        - 204
        - 40
        - 32
      japan--road_facilities_jct_jpn:
        - 378
        - 70
        - 48
        - 32
      japan--road_facilities_pa_jpn:
        - 378
        - 240
        - 40
        - 32
      japan--road_facilities_sa_jpn:
        - 378
        - 276
        - 40
        - 32
      japan--road_facilities_smart_ic_jpn:
        - 2
        - 2
        - 100
        - 32
      japan--toll_booth_jpn:
        - 378
        - 312
        - 36
        - 36
      japan--traffic_light:
        - 378
        - 106
        - 46
        - 46
      japan--transport_aerial:
        - 310
        - 138
        - 64
        - 64
      japan--transport_airport:
        - 310
        - 206
        - 64
        - 64
      japan--transport_inclined:
        - 2
        - 310
        - 64
        - 64
      japan--transport_monorail:
        - 70
        - 310
        - 64
        - 64
      japan--transport_rail_citymetro:
        - 138
        - 310
        - 64
        - 64
      japan--transport_rail_light:
        - 206
        - 310
        - 64
        - 64
      japan--transport_shinkansen_jpn:
        - 274
        - 310
        - 64
        - 64
      japan--transport_train:
        - 378
        - 2
        - 64
        - 64
styles:
  jp_pois:
    base: points
    blend_order: 1
    draw:
      texture: jp_pois
      size: |
        function() {
          const poi_extra_data = context.sources[$source].config.extra_data.poi;
          return global.get_poi_style(feature, 'IPC', poi_extra_data).size || 16;
        }
layers:
  pois:
    IPC:
      filter:
        all:
          - source: ipc
          - |
            function() {
              const poi_extra_data = context.sources[$source].config.extra_data.poi;
              return !!global.get_poi_style(feature, 'IPC', poi_extra_data);
            }
          - global.poi_min_zoom_filter
      draw:
        jp_pois:
          visible: global.poi.IPC.visible
          priority: |
            function() {
              const poi_extra_data = context.sources[$source].config.extra_data.poi;
              return global.label.priorities['poi-labels'] +
                  global.get_poi_style(feature, 'IPC', poi_extra_data).priority;
            }
          sprite: |
            function() {
              const poi_extra_data = context.sources[$source].config.extra_data.poi;
              return global.get_poi_style(feature, 'IPC', poi_extra_data).icon;
            }
          text:
            anchor: top
            text_source: global.ux_language_text_source
            font:
              family: global.text_font_family
              fill: 'rgb(100, 100, 100)'
              size: 12px
              stroke:
                color: 'rgba(240, 246, 247, 0.59)'
                width: 1px
      traffic_lights:
        filter:
          all:
            - pds_category: 900-9400-0402
            - has_traffic_lights: true
        draw:
          jp_pois:
            priority: |
              function() {
                const poi_extra_data = context.sources[$source].config.extra_data.poi;
                return global.label.priorities['japan-traffic-light-labels'] +
                    global.get_poi_style(feature, 'IPC', poi_extra_data).priority;
              }
            text:
              offset:
                - 0
                - 4
              background:
                color: 'rgba(0,0,0,.3)'
              padding:
                - 0
                - 1
              font:
                fill: '#ffffff'
                size: 9.5px
                stroke:
                  width: 0
      road_facility:
        filter:
          all:
            - pds_category:
                - 900-9400-0402
                - 400-4300-0199
                - 400-4300-0200
                - 400-4300-0201
            - has_traffic_lights: false
        draw:
          jp_pois:
            priority: |
              function() {
                const poi_extra_data = context.sources[$source].config.extra_data.poi;
                return global.label.priorities['japan-road-facility-labels'] +
                    global.get_poi_style(feature, 'IPC', poi_extra_data).priority;
              }
            text:
              offset:
                - 0
                - -1
              background:
                color: 'rgba(18,89,82,.6)'
              padding:
                - 0
                - 1
              font:
                fill: '#ffffff'
                size: 9.5px
                stroke:
                  width: 0
      public_transport:
        filter:
          any:
            - pds_category:
                - 400-4000-4581
                - 400-4000-4582
                - 400-4100-0038
                - 400-4100-0339
                - 400-4100-0340
                - 400-4100-0342
                - 400-4100-0037
                - 400-4100-0337
            - all:
                - pds_category: 400-4100-0035
                - any:
                    - is_speed_rail: true
                    - is_state_rail: true
                    - is_private_rail: true
        draw:
          jp_pois:
            priority: |
              function() {
                const poi_extra_data = context.sources[$source].config.extra_data.poi;
                return global.label.priorities['japan-public-transport-labels'] +
                    global.get_poi_style(feature, 'IPC', poi_extra_data).priority;
              }
      multimodal_public_transport:
        filter:
          pds_category: 400-4100-0043
        draw:
          jp_pois:
            priority: |
              function() {
                const poi_extra_data = context.sources[$source].config.extra_data.poi;
                return global.label.priorities['japan-public-transport-labels'] +
                    global.get_poi_style(feature, 'IPC', poi_extra_data).priority;
              }
      governmental_office:
        filter:
          any:
            - pds_category: 800-8100-0163
            - all:
                - pds_category: 800-8100-0171
                - kind_detail:
                    - prefectural_office
                    - town_village_office
                    - ward_office
        draw:
          jp_pois:
            priority: |
              function() {
                const poi_extra_data = context.sources[$source].config.extra_data.poi;
                return global.label.priorities['japan-governmental-office-labels'] +
                    global.get_poi_style(feature, 'IPC', poi_extra_data).priority;
              }
            size:
              - - 13
                - 14px
              - - 15
                - 18px
              - - 16
                - 21px
              - - 18
                - 22px
              - - 20
                - 23px
              - - 24
                - 25px
            text:
              font:
                fill:
                  - - 14.5
                    - '#646464'
                  - - 15.5
                    - '#0c548c'
                size:
                  - - 13
                    - 12px
                  - - 16
                    - 13.5px
                  - - 18
                    - 16px
                  - - 20
                    - 19px
                  - - 24
                    - 23px
                stroke:
                  width:
                    - - 13
                      - 1px
                    - - 16
                      - 1.5px
                  color:
                    - - 14.5
                      - 'rgba(255, 255, 255, 0.59)'
                    - - 15.5
                      - 'rgba(241, 246, 247, 0.39)'
      only_label:
        filter: |
          function() {
            const poi_extra_data = context.sources[$source].config.extra_data.poi;
            return !global.get_poi_style(feature, 'IPC', poi_extra_data).icon;
          }
        draw:
          text-blend-order:
            priority: |
              function() {
                const poi_extra_data = context.sources[$source].config.extra_data.poi;
                return global.label.priorities['poi-labels'] +
                    global.get_poi_style(feature, 'IPC', poi_extra_data).priority;
              }
            visible: global.poi.IPC.visible
            anchor: center
            text_source: global.ux_language_text_source
            font:
              family: global.text_font_family
              fill: 'rgb(100, 100, 100)'
              size: 12px
              stroke:
                color: 'rgba(240, 246, 247, 0.59)'
                width: 1px
        public_transit_access:
          filter:
            pds_category: 400-4100-0040
          draw:
            text-blend-order:
              background:
                color: 'rgba(212, 63, 85, 0.6)'
              font:
                fill: '#ffffff'
                size: 9px
                stroke:
                  width: 0
        intersection:
          filter:
            all:
              - pds_category: 900-9400-0402
              - kind_detail: intersection
          draw:
            text-blend-order:
              priority: |
                function() {
                  const poi_extra_data = context.sources[$source].config.extra_data.poi;
                  return global.label.priorities['japan-traffic-light-labels'] +
                      global.get_poi_style(feature, 'IPC', poi_extra_data).priority;
                }
              background:
                color: 'rgba(0,0,0,.3)'
              font:
                fill: '#ffffff'
                size: 9px
                stroke:
                  width: 0
